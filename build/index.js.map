{"version":3,"sources":["../server/index.js"],"names":["dotenv","config","silent","app","PORT","process","env","ENV","NODE_ENV","SockServer","require","server","use","express","static","path","join","__dirname","authRouter","userRouter","adminRouter","productRouter","orderRouter","get","getLan","req","res","next","data","params","c_status","lan","api","getList","then","cty","response","map","title","JSON","parse","entry","name","id","alt","NULL","cities","mob","match","status","json","catch","message","err","console","log","sendFile","send","listen","options","key","fs","readFileSync","cert","wsServer","httpServer","on","connection","request","accept","origin"],"mappings":"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","file":"index.js","sourcesContent":["import express from 'express'\nimport spdy from 'spdy'\nimport path from 'path'\nimport fs from 'fs'\nimport jwt from 'jsonwebtoken'\nimport dotenv from 'dotenv'\nimport requestLanguage from 'express-request-language'\nimport authRouter from './routes/auth'\nimport userRouter from './routes/user'\nimport adminRouter from './routes/admin'\nimport productRouter from './routes/product'\nimport orderRouter from './routes/order'\nimport api from './api/'\nimport { getLan } from './middleware/'\n\ndotenv.config({silent: true})\nlet app = express()\nlet PORT = process.env.PORT || 8080\nlet ENV = process.env.NODE_ENV || 'development'\n\nlet SockServer = require('websocket').server\n\napp.use('/static', express.static(path.join(__dirname, '../client/build/static')) )\napp.use('/img', express.static(path.join(__dirname, '../client/build/img')) )\napp.use(express.static(path.join(__dirname, '../client/build/')) )\n\n// == ROUTES ==============================================\napp.use('/auth', authRouter)\napp.use('/user', userRouter)\napp.use('/admin', adminRouter)\napp.use('/products',productRouter)\napp.use('/order',orderRouter)\n\n// ========================================================\n\napp.get('/ui', getLan, (req,res,next) => {\n  let data = {}\n  let params = {\n    c_status: 4\n  }\n  const { lan } = req\n// SWITCH to:    req.language// === 'en' ? 'bg' : req.language\n  //if(lng === 'lan') {\n  //  data.lan = req.language==='es'? 'es' : 'bg'\n  //} else {\n    data.lan = lan\n  //}\n// get cities: ? add params {c_status: 4} if needed\n  api.getList('city',['name','id','zone','code','alt'],params).then( response => {//,{c_status: 4}\n    const cty = response.map( entry => {\n//switch BG to req.language in production\n      return {\n        title: JSON.parse(entry.name)[data.lan],\n        id: entry.id,\n        //status: entry.c_status,\n        alt: entry.alt ? JSON.parse(entry.alt)[data.lan] : NULL\n      }\n    })\n    data.cities = cty\n    data.mob = req.get('user-agent').match((/(Mobile)/g)) ? true : false\n    res.status(200).json(data)\n  })\n  .catch( err => res.status(500).json({message: 'Something went wrong...'}))\n})\n\napp.get('/*', (req,res) => {\n  const {err} = req\n  console.log('Root: ',ENV)\n  if(ENV==='production'){\n    console.log('Running: ',ENV)\n    res.sendFile(path.join(__dirname, '../client/build/index.html'))\n  } else if(!err) {\n    res.send('This is not a Web Page! Check your routes...')\n  } else {\n    res.send(err.message)\n  }\n})\n\nlet server = app.listen(PORT, () => {\n  console.log('Server Running in: ',process.env.PORT)\n})\n\n// TRY HTTP2: no ssl-file\nconst options = {\n  key: fs.readFileSync(__dirname + '/ssl/server.key'),\n  cert:fs.readFileSync(__dirname + '/ssl/server.srt'),\n}\n//const server = spdy.createServer(options,app).listen(PORT, error => {\n//  if(error){\n//    console.log(error)\n//    return process.exit(1)\n//  } else {\n//    console.log('H2 running on: ', PORT)\n//  }\n//})\n// # WebSocket-Node Serer #\nlet wsServer = new SockServer({\n  httpServer: server\n})\n// WebSocketServer Class:\nwsServer.on('request', request => {\n// request is webSocketRequest Object\n// .accept returns webSocketConnection Instance\n  let connection = request.accept(null,request.origin)\n  connection.on('message', message => {\n    console.log('Socket: ',request.origin, message)\n  })\n})\n"]}