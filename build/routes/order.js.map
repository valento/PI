{"version":3,"sources":["../../server/routes/order.js"],"names":["orderRouter","express","Router","mergeParams","use","bodyParser","json","post","getUserId","req","res","next","uid","body","data","user_location","delivery","fac_id","total","cart","api","saveOne","Object","assign","then","details","map","order_id","id","item","o","product","quant","saveMany","updateOne","orders","status","message","catch","err","get"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AACA;;;;;;AAEA,IAAIA,cAAcC,kBAAQC,MAAR,CAAe;AAC/BC,eAAa;AADkB,CAAf,CAAlB;;AAIAH,YAAYI,GAAZ,CAAgBC,qBAAWC,IAAX,EAAhB;;AAEAN,YAAYO,IAAZ,CAAiB,GAAjB,EAAsBC,qBAAtB,EAAiC,UAACC,GAAD,EAAKC,GAAL,EAASC,IAAT,EAAkB;AAAA,MAC1CC,GAD0C,GACnCH,GADmC,CAC1CG,GAD0C;AAAA,uBAEEH,IAAII,IAAJ,CAASC,IAFX;AAAA,MAE1CC,aAF0C,kBAE1CA,aAF0C;AAAA,MAE5BC,QAF4B,kBAE5BA,QAF4B;AAAA,MAEnBC,MAFmB,kBAEnBA,MAFmB;AAAA,MAEZC,KAFY,kBAEZA,KAFY;AAAA,MAENC,IAFM,kBAENA,IAFM;AAGjD;;AACAC,gBAAIC,OAAJ,CAAYC,OAAOC,MAAP,CAAc,EAAd,EAAiB,EAACX,QAAD,EAAjB,EAAuB,EAACG,4BAAD,EAAeC,kBAAf,EAAwBE,YAAxB,EAA8BD,cAA9B,EAAvB,CAAZ,EAA0E,QAA1E,EACCO,IADD,CACO,cAAM;AACX,QAAIC,UAAUN,KAAKO,GAAL,CAAU,aAAK;AAC3B,aAAO,EAACC,UAAUC,EAAX,EAAeC,MAAMC,EAAEC,OAAvB,EAAgCC,OAAOF,EAAEE,KAAzC,EAAP;AACD,KAFa,CAAd;AAGAZ,kBAAIa,QAAJ,CAAaR,OAAb,EAAqB,cAArB;AACD,GAND,EAOCD,IAPD,CAOO;AAAA,WAAMJ,cAAIc,SAAJ,CAAc,EAACN,IAAIhB,GAAL,EAAUuB,QAAO,UAAjB,EAAd,EAA2C,MAA3C,CAAN;AAAA,GAPP,EAQCX,IARD,CAQO;AAAA,WAAMd,IAAI0B,MAAJ,CAAW,GAAX,EAAgB9B,IAAhB,CAAqB,EAAC+B,SAAS,gBAAV,EAArB,CAAN;AAAA,GARP,EASCC,KATD,CASQ;AAAA,WAAO5B,IAAI0B,MAAJ,CAAW,GAAX,EAAgB9B,IAAhB,CAAqB,EAAC+B,SAASE,GAAV,EAArB,CAAP;AAAA,GATR;AAUD,CAdD;;AAgBAvC,YAAYwC,GAAZ,CAAgB,OAAhB,EAAyB,UAAC/B,GAAD,EAAKC,GAAL,EAASC,IAAT,EAAkB;AACzC;AACD,CAFD;;kBAIeX,W","file":"order.js","sourcesContent":["import express from 'express'\nimport bodyParser from 'body-parser'\nimport { getLan,getUserId } from '../middleware/'\nimport api from '../api/'\n\nlet orderRouter = express.Router({\n  mergeParams: true\n})\n\norderRouter.use(bodyParser.json())\n\norderRouter.post('/', getUserId, (req,res,next) => {\n  const {uid} = req\n  const {user_location,delivery,fac_id,total,cart} = req.body.data\n  //console.log(uid, req.body.data)\n  api.saveOne(Object.assign({},{uid},{user_location,delivery,total,fac_id}),'orders')\n  .then( id => {\n    let details = cart.map( o => {\n      return {order_id: id, item: o.product, quant: o.quant}\n    })\n    api.saveMany(details,'order_detail')\n  })\n  .then( () => api.updateOne({id: uid, orders:'orders+1'},'user') )\n  .then( () => res.status(200).json({message: 'Order recieved'}) )\n  .catch( err => res.status(500).json({message: err}) )\n})\n\norderRouter.get('/:fac', (req,res,next) => {\n  // Get Pending Orders:\n})\n\nexport default orderRouter\n"]}